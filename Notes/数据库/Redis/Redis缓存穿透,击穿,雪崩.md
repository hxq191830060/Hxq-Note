# 10. Redis缓存穿透,击穿,雪崩

## 10.1 缓存穿透

### 什么是缓存穿透

用户查询一个数据，Redis中没有(缓存没命中)，于是向持久层数据库查询，持久层数据库也没有。当这样的查询很多时，缓存都没有命中，于是都去请求持久层数据库，这就是缓存穿透

### 解决方案

#### 1. 布隆过滤器

布隆过滤器是一种数据结构，对查询使用的所有参数以hash形式存储，在控制层进行校验，不符合则丢弃，避免了对底层存储系统的查询压力

![布隆过滤器](D:\桌面\Notes\Notes\数据库\Redis\p\布隆过滤器.png)



#### 2. 缓存空对象

当存储层未命中后，即使返回空对象也存储起来，同时设置一个过期时间

![缓存空对象](D:\桌面\Notes\Notes\数据库\Redis\p\缓存空对象.png)

**缓存空对象的问题**

1. 如果空值能被缓存起来，这就意味着缓存需要更多的哦空间存储更多的键
2. 即使对空值设置了过期时间，还是会存在缓存层和存储层的数据有一段时间的不一致

## 10.2 缓存击穿

### 什么是缓存击穿

缓存击穿——指的是一个key非常热点，不停的扛着大并发

这个key过期的瞬间，大量的请求并发访问持久层数据库，导致数据库瞬间压力过大

### 解决方案

#### 1. 设置热点数据永不过期

#### 2. 加互斥锁

分布式锁，使用分布式锁，保证对于每个key，某一时间只有一个线程去查询持久层数据



## 10.3 缓存雪崩

### 什么是缓存雪崩

某一个时间段，缓存集中过期失效

例如：马上到双十二零点，这波商品数据集中放入缓存，假设缓存1小时，到了凌晨1点时，这批商品的缓存都过期了，对这批商品的访问，都直接落在了持久层数据库上。

key集中过期并不是非常致命

比较致命的缓存雪崩，是缓存服务器的某个节点宕机或者断网

### 解决方案

#### 1. Redis高可用

#### 2. 限流降级

#### 3. 数据预热

在正式部署之前，先把可能的数据预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中