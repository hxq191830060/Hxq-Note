**前提**

* 开启了binlog——使用两阶段提交
* 使用InnoDB存储引擎
* innodb_flush_at_trx_commit=1
* sync_binlog=1



1. 前面的步骤`同查询sql类似`，连接数据库，让查询缓存失效，经过分析器的词法和语法分析，再经过优化器的优化，最后走到执行器

2. **执行器**首先向**存储引擎**查找符合条件的数据

   **存储引擎**首先会在内存的缓冲池中查找，如果有，直接使用缓存的数据，如果没有，从磁盘中读取满足条件的额数据放到缓存池中，然后**返回给执行器**

3. **执行器**获取到数据后，对数据进行修改，然后**调用存储引擎的接口**写入新数据

4. **存储引擎**将新数据先在缓冲池中进行更新，同时将这个更新操作记录到**redo log buffer**中

   **undo log也是在这个时候写入的**

5. **执行器**将逻辑操作日志写入**binlog cache**

6. 进行两阶段提交，并且会将undo log放入一个链表中，未来通过purge删除

