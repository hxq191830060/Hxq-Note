[toc]

### 1. 上下文切换

#### 1.1 上下文切换的概念

* CPU为分出一个个时间片，每个线程分配到若干个时间片

* CPU通过 **时间片分配算法**来执行任务，当线程的时间片用完后，CPU会切换到下一个线程的任务，CPU就这样不停的切换线程执行

* 每个线程都有一个**程序计数器**，用来记录下一条要执行的指令的地址,方便方法上下文切换时,操作系统记录线程的状态,方便下次执行时,恢复到原状态   

#### 1.2 上下文切换的弊端

上下文切换需要一定的时间，当程序比较小的时候，并发由于上下文切换，执行效率会低于串行

#### 1.3 减少上下文切换

* **无锁并发编程**：多线程竞争锁时，会引起上下文切换
* **CAS算法**：使用CAS算法更新数据，而不要加锁
* **使用最少线程**
* **使用协程**



### 2. 线程安全问题

#### 2.1 死锁

我们要避免死锁

* 避免一个线程同时获得多个锁
* 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源
* 尝试使用定时锁