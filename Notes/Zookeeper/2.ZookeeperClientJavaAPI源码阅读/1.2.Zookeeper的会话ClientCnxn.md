**ClientCnxn  cnxn——最重要的属性，这是会话**  

负责与服务器进行通信+很多其他功能

**会话有三个核心内部类——SendThread，EventThread，Packet**



### **会话的属性**

* int connectTimeout :最大心跳时间，如果未交互时间超过该值，会话将断开

* long sessionId

* byte[] sessionPasswd

* boolean readOnly

* SendThread sendThread：负责向服务器发送请求，接受请求

* EventThread eventThread：当客户端设置的Watch触发时，负责接受服务器传来的Event对象，并做出相应的处理

* HostProvider hostProvider：该客户端可以连接的服务器的集合

* ZKClientConfig clientConfig：该客户端的配置信息

* Queue<Packet>pendingQueue：已经发送的，正在等待服务器响应的Packet

* LinkedBlockingDeque<Packet> outgoingQueue：准备要发送的Packet，一个线程调用Zookeeper Client客户端的方法时，会把请求封装为Packet对象，然后把Packet对象放入outgoing中，等待SendThread发送

* ZKWatchManager watchManager：管理客户端所持有的所有的watch
  * Map<String,Set<Watcher>>dataWatches
  * Map<String,Set<Watcher>>existWatches
  * Map<String,Set<Watcher>>childWatches
  * Map<String,Set<Watcher>>persistenWatches
  * Map<String,Set<Watcher>>persistentRecursiveWatches



### **会话的内部类**



* **AuthData**

  存储从服务器读取的节点的信息

  * scheme：节点的属性
  * data：节点存储的数据

* **Packet**

  Client与Server之间的信息传输，都是通过Packet
  
* **SendThread**

  

* **EventThread**

* **WatcherSetEventPair**

  ```java
  public class WatcherSetEventPair {
      private final Set<Watcher> watchers;
      private final WatchedEvent event;
  
      public WatcherSetEventPair(Set<Watcher> watchers, WatchedEvent event) {
          this.watchers = watchers;
          this.event = event;
      }
  }
  ```

  