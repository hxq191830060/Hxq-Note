

# 1. Redis介绍

## 1.1 Redis是什么

Redis（REmote DIctionary Server）远程字典服务

一个开源的支持网络，可基于内存亦持久化的日志型，Key-Value数据库

## 1.2 Redis可以做什么

### 1.2.1 缓存

合理的使用缓存可以加快数据的访问速度，而且可以有效地降低后端数据源的压力

### 1.2.2 排行榜系统

Redis提供了列表和有序集合数据结构，可以很方便的构建排行榜系统

### 1.2.3 计数器应用

Redis天然支持计数功能

### 1.2.4 社交网络

### 1.2.5 消息队列系统

Redis提供发布订阅功能和阻塞队列的功能，可以构建一般的消息队列



# 2. Redis基础知识

## 2.1 Redis数据库

### 2.1.1 Redis数据库数目

**redis.conf**中**databases 16**决定Redis数据库数目（0-15，总共16个数据库）

### 2.1.2 Redis数据库操作

* **数据库大小**

  ```
  dbsize
  ```

* **切换数据库**

  ```
  select num
  ```

* **清除当前数据库**

  ```
  flushdb
  ```

* **清除所有数据库**

  ```
  flushall
  ```

## 2.2 Redis是单线程的

* Redis4.0前，Redis是完全单线程

* Redis4.0后，引入了多线程，但是额外的线程只是用于后台处理

* 在 redis 6.0 之前，redis 的核心操作是单线程的

  **这里的单线程指的是——主要是指Redis的网络IO和键值读写是由一个线程来完成的。Redis的其他功能，比如持久化，异步删除，集群数据同步等，是由额外的线程来完成的**

* 因为 redis 是完全基于内存操作的，通常情况下CPU不会是redis的瓶颈，redis 的瓶颈最有可能是机器内存的大小或者网络带宽。既然CPU不会成为瓶颈，那就顺理成章地采用单线程的方案了，因为如果使用多线程的话会更复杂，同时需要引入上下文切换、加锁等等，会带来额外的性能消耗。

  最近的 6.0 版本就对**核心流程**引入了多线程，主要用于解决 **redis 在网络 I/O 上的性能瓶颈**——有**多个IO线程**处理网络请求，而对于核心的命令执行阶段，目前还是单线程的。

## 2.3 Redis为什么那么快

1. 纯内存访问。

   Redis将所有数据放在内存中，这是Redis达到每秒万级别访问的重要基础

2. 高效的数据结构

3. 使用IO多路复用模型

4. 单线程避免了线程切换和竞态产生的消耗





# 3. Redis使用到的分布式协议

## 3.1 Gossip

Redis Cluster内部通信



## 3.2 Quorum

Redis Sentinel对master客观下线判断



## 3.3 Raft

Redis Sentinel leader选举
