* CPU寄存器和程序计数器是CPU运行任何任务前都必须依赖的环境，这些环境叫**上下文** 

* CPU上下文切换分为三种
  
  * 进程上下文切换
  
  * 线程上下文切换
  
  * 中断上下文切换

## 1. 进程上下文切换

* 进程由内核管理，进程的切换只能发生在内核态
- 进程的上下文切换包含了地址空间，栈，全局变量等用户空间资源，也包括内核堆栈，寄存器等内核空间的资源

- 进程上下文切换会将**用户态资源**和**内核态资源**保存起来（PCB中），然后加载下一个进程的用户态资源和内核态资源

- 发生进程上下文切换的场景
  
  * CPU在运行进程时，给进程分配了时间片，当某个进程分配到的时间片耗尽时，从就绪队列选择另一个进程运行
  
  * 进程通过sleep主动将自己挂起，CPU会去调度其他进程

## 2. 线程上下文切换

- 线程切换时，地址空间保持不动，只需要将**当前线程的私有资源**保存起来，然后加载下一个线程的私有资源即可（例如寄存器，栈）

## 3. 中断上下文切换

* 中断请求会打断OS对进程的正常调度，转为执行中断处理程序

* 中断上下文切换不涉及进程的用户态资源，只会切换内核态中断处理程序执行所必须的资源
