CPU寄存器和程序计数器是CPU运行任何任务前都必须依赖的环境，这些环境叫**上下文**

上下文分为三种

- CPU上下文切换（系统调用）

- 进程上下文切换

- 线程上下文切换

## 2.1 进程上下文切换

- 各个进程之间是共享CPU资源的，在不同的时候，进程之间需要进行切换，让不同的进程在CPU上执行，CPU上执行的进程从一个进程变为另一个进程，这就是进程的上下文切换

- 进程的上下文切换包含了地址空间，栈，全局变量等用户空间资源，也包括内核堆栈，寄存器等内核空间的资源
  
  通常，会把交换的信息保存在PCB中，当要运行另一个进程时，从这个进程的PCB中取出上下文，恢复到CPU中

### 发生进程上下文切换的场景

- CPU在运行进程时，给进程分配了时间片，当某个进程分配到的时间片耗尽时，从就绪队列选择另一个进程运行
- 进程通过sleep主动将自己挂起，CPU会去调度其他进程
- 发送硬件中断时，CPU上的进程会被中断挂起，CPU会去执行中断处理程序

## 2.2 线程上下文切换

- 线程切换时，地址空间保持不动，主需要切换线程的私有数据即可（例如寄存器，栈）
