一个进程必须能够执行一些受限制的操作（例如IO），但又不能让进程完全控制系统

## 1. 执行模型

* 用户模式：应用程序不能访问全部的硬件资源
* 内核模式：可以访问机器的全部资源，包括特权操作（发出IO请求，执行所有类型的受限指令）

## 2. 系统调用

OS通过**系统调用**向应用程序暴露某些关键能力（访问文件系统，创建和销毁进程，分配更多内存等）

应用程序可以通过**系统调用**，从用户模式切换为内核模式，然后执行受限制的操作，执行完后，切换回用户模式

## 3. trap table

OS启动的时候，会初始化trap table

trap table存储的是**中断号**与**中断处理程序**的地址

- 系统调用属于软件中断
- **中断处理程序**
  - **系统调用处理程序**
  - **时钟处理程序****

 

## 4. 特权模式切换

* 系统调用过程称为特权模式切换，包含了2次**CPU上下文切换**（不会涉及到进程的用户态资源）

* 提供**trap**和**return-from-trap**指令来进行特权模式转换

### 4.1 执行trap

1. 保存CPU上下文信息

2. 切换为内核模式

3. 跳转到**trap处理程序**，会将对应的系统调用号（中断号的一种）传递给trap处理程序

### 4.2 trap处理程序

trap处理程序根据系统调用号（中断号的一种），从trap table中找到对应的处理程序的地址，执行处理程序

### 4.3 执行return-from-trap

1. 恢复CPU的上下文信息

2. 切换回用户模式

3. 跳转到程序计数器记录的地址

# 

​    
