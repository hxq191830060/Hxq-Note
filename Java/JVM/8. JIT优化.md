## 1. JIT

Java编译器解释执行字节码时，如果发现某个方法or代码块运行特别频繁，会认为这是热点代码，JIT会将热点代码翻译位机器码，将机器码缓存起来，下次使用

> 基于计数器的热点探测——为方法or代码块建立计数器，统计执行次数，执行次数超过某个阈值就认为是热点代码

## 2. 编译优化

JIT识别出热点代码后，除了将机器码缓存起来外，还有进行优化

* 逃逸分析

* 锁消除

* 锁膨胀

* 方法内联

* 空值检查消除

* 类型检查消除

* 公共子表达式

### 3. 逃逸分析

* 逃逸分析会分析对象的作用域，如果一个对象在方法中被定义后，可能会被外部方法引用（例如通过调用参数传递到其他地方），那么就成为方法逃逸

* 逃逸分析会分析出对象的作用域，然后决定是否将对象分配到堆上

* 如果JIT发现某个对象没有逃逸，那么就可以进行以下优化
  
  * 同步省略
  
  * 标量替换
  
  * 栈上分配

### 3.1 标量替换和栈上分配

* java原始数据类型是标量

* 可以分解的数据叫聚合量，对象是聚合量，聚合量可以分解为其他聚合量+标量

如果逃逸分析发现一个对象只会在方法内被访问，那么就可以将对象拆分为若干个成员变量来代替，这就是标量替换

通过标量替换，实现对象的栈上分配
