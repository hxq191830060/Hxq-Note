### 参与者开发规范

1. 业务幂等性：一二阶段都必须幂等

2. 不允许提交已经回滚的事务

3. 允许空回滚，参与者返回成功，并记录已经回滚

4. 不允许空提交，参与者要返回失败

5. 防止事务悬挂：一阶段如果发现二阶段执行过，要返回失败

6. 数据可见性：如果分布式事务处理中间态，此时有查询，要兼容中间态数据的可见性

### dtx使用流程

1. 管理者开启DTX事务，去dtx-server注册一条主事务记录（状态为INIT），并分配主事务id

2. 管理者调用参与者接口前，向dtx-server注册分支事务记录（状态为INIT），然后调用参与者接口

3. 管理者结束分布式事务，会通过dtx-server进行二阶段，dtx-server将主事务记录的状态修改为COMMOT/ROLLBACK，管理者收到dtx-server的响应后就认为事务完成了，向上游返回业务结果

4. 二阶段由dtx-server异步推进，dtx-server会根据分支事务记录去调用参与者的commit/rollback方法，失败会不断重试直到成功

5. 管理者需要提供回查接口，让dtx-server可以回查主事务的状态（网络不稳定的情况下使用）
