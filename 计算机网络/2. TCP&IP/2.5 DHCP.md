

**DHCP——Dynamic Host Configuration Protocol动态主机配置协议**

DHCP需要假设一台DHCP服务器，并且IT人员需要配置一段共享的IP地址。每一台新接入的机器都通过DHCP协议，来这个共享的IP地址里申请，然后自动配置好就可以了



##  过程

一台机器开始加入网络

### 1. DHCP Discover

新来的机器使用**0.0.0.0作为源IP**，使用**广播IP255.255.255.255作为目标IP**来发送广播包

广播包封装了UDP，UDP封装了BOOTP，告知自己的MAC地址，请求一个IP地址

![1](D:\文档\hxq的重要文件\github\note\计算机网络\2. TCP&IP\p\1.png)

### 2. DHCP offer

* DHCP Server使用 **广播IP255.255.255.255作为目标IP**来发送广播包，告知新人它被分配到的IP（还包括子网掩面，网关，IP地址租用期等信息）

  ![2](D:\文档\hxq的重要文件\github\note\计算机网络\2. TCP&IP\p\2.png)

**如果有多台DHCP Server，那么新人会收到多个Offer**

* 新人会选择最先到达的Offer，再次以 **0.0.0.0作为源IP地址**，**广播地址255.255.255.255作为目标IP地址**，发送一个广播包（包中包含客户端的MAC地址、接受的租约中的IP地址、提供此租约的DHCP服务器地址等，并告诉所有DHCP Server它将接受哪一台服务器提供的IP地址，让其他DHCP Server撤销它们提供的IP）

  ![2](D:\文档\hxq的重要文件\github\note\计算机网络\2. TCP&IP\p\3.png)

* DHCP Server接收到客户机的DHCP request之后，会广播返回给客户机一个DHCP ACK消息包，表明已经接受客户机的选择，并将这一IP地址的合法租用信息和其他的配置信息都放入该广播包，发给客户机

  ![2](D:\文档\hxq的重要文件\github\note\计算机网络\2. TCP&IP\p\4.png)

### 3. IP的赎回与续租

IP地址的租期到了，会收回

客户机会在租期过去50%的时候，直接向为其提供IP地址的DHCP Server发送DHCP request消息包。客户机接收到该服务器回应的DHCP ACK消息包，会根据包中所提供的新的租期以及其他已经更新的TCP/IP参数，更新自己的配置。这样，IP租用更新就完成了



